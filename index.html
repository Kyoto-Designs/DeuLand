<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Glass Calendar Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        :root {
            --bg-main: #0B0B0B;
            --orange-glass: rgba(255, 106, 0, 0.5);
            --orange-solid: #FF6A00;
            --blur-val: 70px;
            --spring-easing: cubic-bezier(0.175, 0.885, 0.32, 1.275);
            --smooth-easing: cubic-bezier(0.22, 1, 0.36, 1);
        }

        body {
            background-color: var(--bg-main);
            color: rgba(255, 255, 255, 0.85);
            font-family: -apple-system, system-ui, sans-serif;
            overflow: hidden;
            height: 100vh;
            font-size: 12px;
            user-select: none;
        }

        /* --- ANIMAÇÕES CORE --- */
        
        /* Fade-Slide Entrada */
        .fade-slide-in {
            animation: fadeSlide 0.2s var(--smooth-easing) forwards;
        }
        @keyframes fadeSlide {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Pop-In Evento */
        .pop-in {
            animation: popIn 0.22s var(--spring-easing) forwards;
        }
        @keyframes popIn {
            0% { transform: scale(0.95); opacity: 0; }
            100% { transform: scale(1); opacity: 1; box-shadow: 0 10px 20px rgba(0,0,0,0.3); }
        }

        /* Bounce Header */
        .header-bounce {
            animation: headerBounce 0.3s var(--spring-easing);
        }
        @keyframes headerBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }

        /* Date Ripple Tap */
        .ripple {
            position: absolute;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 50%;
            transform: scale(0);
            animation: rippleAnim 0.35s linear;
            pointer-events: none;
        }
        @keyframes rippleAnim {
            to { transform: scale(4); opacity: 0; }
        }

        /* --- UI STYLES --- */

        .orange-glass {
            background: var(--orange-glass);
            backdrop-filter: blur(var(--blur-val));
            -webkit-backdrop-filter: blur(var(--blur-val));
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.2s var(--smooth-easing);
        }

        .glass-header {
            background: rgba(11, 11, 11, 0.8);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.03);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: rgba(255, 255, 255, 0.03);
        }

        .calendar-cell {
            background: var(--bg-main);
            min-height: 65px;
            padding: 4px;
            position: relative;
            overflow: hidden;
            transition: transform 0.16s ease;
        }

        .calendar-cell:active {
            transform: scale(1.02);
            z-index: 10;
        }

        .today-indicator {
            background: var(--orange-solid);
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 9px;
            font-weight: 900;
            box-shadow: 0 0 10px var(--orange-glass);
            animation: badgePop 0.28s var(--spring-easing);
        }

        @keyframes badgePop {
            0% { transform: scale(0) rotate(-20deg); }
            100% { transform: scale(1) rotate(0); }
        }

        /* Toast / Undo Snack */
        .toast {
            position: fixed;
            bottom: -80px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            max-width: 280px;
            padding: 10px 16px;
            border-radius: 20px;
            z-index: 100;
            transition: bottom 0.26s var(--smooth-easing);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .toast.show { bottom: 30px; }

        /* Agenda Stagger */
        .agenda-item {
            opacity: 0;
            transform: translateY(10px);
        }

        .event-pill {
            font-size: 8px;
            padding: 1px 4px;
            border-radius: 4px;
            margin-top: 1px;
            background: rgba(255, 255, 255, 0.05);
            border-left: 2px solid var(--orange-solid);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Modal */
        #modal-overlay {
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(10px);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.24s ease;
        }
        #modal-overlay.active { opacity: 1; pointer-events: all; }
        
        #event-modal {
            transform: scale(0.9);
            transition: transform 0.22s var(--spring-easing);
        }
        #modal-overlay.active #event-modal { transform: scale(1); }

        /* Seletor de data popover */
        .mini-cal-pop {
            transform-origin: top;
            animation: scaleYIn 0.24s var(--smooth-easing);
        }
        @keyframes scaleYIn { from { transform: scaleY(0); opacity: 0; } to { transform: scaleY(1); opacity: 1; } }
    </style>
</head>
<body class="flex flex-col">

    <header class="glass-header px-4 py-2 z-40">
        <div class="flex items-center justify-between mb-2" id="header-nav">
            <div class="flex items-center gap-3">
                <button onclick="navigate(-1)" class="text-white/40 active:scale-75 transition-transform"><i class="ph-bold ph-caret-left"></i></button>
                <h1 id="month-display" class="text-sm font-bold tracking-tight min-w-[100px] text-center">Janeiro 2026</h1>
                <button onclick="navigate(1)" class="text-white/40 active:scale-75 transition-transform"><i class="ph-bold ph-caret-right"></i></button>
            </div>
            <button onclick="goToToday()" class="orange-glass text-[9px] px-3 py-1 rounded-full uppercase font-black">Hoje</button>
        </div>
        
        <div class="flex gap-2 items-center">
            <div class="relative flex-1">
                <input type="text" id="quick-input" placeholder="Adicionar rápido..." class="w-full bg-white/5 rounded-xl py-2 px-4 text-[11px] focus:outline-none focus:bg-white/10 transition-all border border-transparent focus:border-orange-500/30">
            </div>
            <div class="flex bg-white/5 p-1 rounded-xl">
                <button onclick="setView('month')" id="v-month" class="px-3 py-1 rounded-lg text-[10px] transition-all">Grid</button>
                <button onclick="setView('agenda')" id="v-agenda" class="px-3 py-1 rounded-lg text-[10px] transition-all">Lista</button>
            </div>
        </div>
    </header>

    <main id="content" class="flex-1 overflow-y-auto relative"></main>

    <button onclick="openModal()" class="orange-glass fixed bottom-6 right-6 w-12 h-12 rounded-2xl flex items-center justify-center shadow-2xl active:scale-90 transition-transform z-30">
        <i class="ph-bold ph-plus text-xl text-white"></i>
    </button>

    <!-- Modal Evento -->
    <div id="modal-overlay" class="fixed inset-0 z-50 flex items-center justify-center p-6">
        <div id="event-modal" class="bg-[#121212] w-full max-w-xs rounded-[30px] p-6 border border-white/5 shadow-2xl">
            <h2 id="modal-title" class="text-lg font-bold mb-5 flex items-center gap-2">
                <i class="ph-fill ph-calendar-plus text-orange-500"></i> Agendar
            </h2>
            <div class="space-y-4">
                <input type="text" id="ev-title" placeholder="Título do evento" class="w-full bg-transparent border-b border-orange-500/30 py-2 text-sm focus:outline-none focus:border-orange-500">
                <div class="flex gap-3">
                    <input type="date" id="ev-date" class="flex-1 bg-white/5 p-2 rounded-xl text-[11px]" style="color-scheme: dark;">
                    <input type="time" id="ev-time" class="w-24 bg-white/5 p-2 rounded-xl text-[11px]" style="color-scheme: dark;">
                </div>
                <div class="flex items-center gap-2">
                    <div class="text-[10px] text-white/40">Cor:</div>
                    <div class="flex gap-2" id="color-picker">
                        <div class="w-4 h-4 rounded-full cursor-pointer border-2 border-white/20 active:scale-125 transition-transform" style="background: #FF6A00" onclick="selCol('#FF6A00')"></div>
                        <div class="w-4 h-4 rounded-full cursor-pointer border-2 border-transparent" style="background: #3B82F6" onclick="selCol('#3B82F6')"></div>
                        <div class="w-4 h-4 rounded-full cursor-pointer border-2 border-transparent" style="background: #A855F7" onclick="selCol('#A855F7')"></div>
                    </div>
                </div>
            </div>
            <div class="mt-8 flex justify-between gap-3">
                <button id="ev-del" onclick="deleteEv()" class="text-red-500 text-[11px] font-bold hidden">Excluir</button>
                <div class="flex gap-3 ml-auto">
                    <button onclick="closeModal()" class="text-white/30 text-[11px]">Fechar</button>
                    <button onclick="saveEv()" class="orange-glass px-5 py-2 rounded-xl text-[11px] font-bold">Salvar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Undo Toast -->
    <div id="toast" class="toast orange-glass">
        <span id="t-msg" class="font-medium">Removido</span>
        <button onclick="undo()" class="text-white font-black border-l border-white/20 pl-3">Desfazer</button>
    </div>

    <script>
        let curr = new Date();
        let view = 'month';
        let evs = JSON.parse(localStorage.getItem('evs_v3')) || [];
        let hist = [];
        let selColor = '#FF6A00';

        const months = ["Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];
        const days = ["D", "S", "T", "Q", "Q", "S", "S"];

        function render() {
            const container = document.getElementById('content');
            container.innerHTML = '';
            document.getElementById('month-display').innerText = `${months[curr.getMonth()]} ${curr.getFullYear()}`;
            
            // Toggle Visual
            ['month', 'agenda'].forEach(v => {
                const btn = document.getElementById(`v-${v}`);
                btn.className = (view === v) ? "px-3 py-1 rounded-lg text-[10px] bg-orange-500/20 text-orange-500 font-bold" : "px-3 py-1 rounded-lg text-[10px] text-white/40";
            });

            if (view === 'month') renderMonth(container);
            else renderAgenda(container);
        }

        function renderMonth(c) {
            const first = new Date(curr.getFullYear(), curr.getMonth(), 1).getDay();
            const last = new Date(curr.getFullYear(), curr.getMonth() + 1, 0).getDate();
            
            let grid = `<div class="calendar-grid fade-slide-in">`;
            days.forEach(d => grid += `<div class="text-center py-2 text-[8px] font-black text-white/20">${d}</div>`);
            
            for(let i=0; i<first; i++) grid += `<div class="calendar-cell opacity-20"></div>`;
            
            for(let d=1; d<=last; d++) {
                const dateStr = `${curr.getFullYear()}-${String(curr.getMonth()+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                const isTday = new Date().toDateString() === new Date(curr.getFullYear(), curr.getMonth(), d).toDateString();
                const dEvs = evs.filter(e => e.date === dateStr);
                
                grid += `
                <div class="calendar-cell border-b border-r border-white/[0.02]" onpointerdown="createRipple(event)" onclick="openWithDate('${dateStr}')">
                    <div class="flex justify-end">
                        <span class="${isTday ? 'today-indicator' : 'text-white/40 text-[10px] font-medium'}">${d}</span>
                    </div>
                    <div class="mt-1 space-y-0.5 overflow-hidden">
                        ${dEvs.slice(0,2).map(e => `<div class="event-pill" style="border-left-color:${e.color}">${e.title}</div>`).join('')}
                        ${dEvs.length > 2 ? `<div class="text-[7px] text-white/20 pl-1">+${dEvs.length-2}</div>` : ''}
                    </div>
                </div>`;
            }
            c.innerHTML = grid + `</div>`;
        }

        function renderAgenda(c) {
            const sorted = [...evs].sort((a,b) => a.date.localeCompare(b.date));
            let html = `<div class="p-4 space-y-3">`;
            if(sorted.length === 0) html += `<div class="text-center py-20 text-white/10 italic">Nenhum evento...</div>`;
            
            sorted.forEach((e, i) => {
                html += `
                <div class="agenda-item pop-in bg-white/5 p-3 rounded-2xl flex items-center gap-4 border border-white/5" 
                     style="animation-delay: ${i * 40}ms" onclick="editEv('${e.id}')">
                    <div class="w-1 h-8 rounded-full" style="background:${e.color}"></div>
                    <div class="flex-1">
                        <div class="text-[11px] font-bold">${e.title}</div>
                        <div class="text-[9px] text-white/30">${e.date} • ${e.time}</div>
                    </div>
                    <i class="ph ph-caret-right text-white/10"></i>
                </div>`;
            });
            c.innerHTML = html + `</div>`;
            // Trigger opacity/transform manual para Stagger
            setTimeout(() => {
                document.querySelectorAll('.agenda-item').forEach(el => el.style.opacity = 1);
            }, 50);
        }

        // --- CORE LOGIC ---

        function navigate(dir) {
            const h = document.getElementById('header-nav');
            h.classList.add('header-bounce');
            setTimeout(() => h.classList.remove('header-bounce'), 300);
            curr.setMonth(curr.getMonth() + dir);
            render();
        }

        function goToToday() { curr = new Date(); render(); }
        function setView(v) { view = v; render(); }

        function openModal() {
            document.getElementById('modal-overlay').classList.add('active');
            document.getElementById('ev-title').focus();
        }

        function openWithDate(d) {
            document.getElementById('ev-date').value = d;
            openModal();
        }

        function closeModal() {
            document.getElementById('modal-overlay').classList.remove('active');
            document.getElementById('ev-id-hidden')?.remove();
            document.getElementById('ev-title').value = '';
            document.getElementById('ev-del').classList.add('hidden');
            document.getElementById('modal-title').innerHTML = `<i class="ph-fill ph-calendar-plus text-orange-500"></i> Agendar`;
        }

        function selCol(c) {
            selColor = c;
            document.querySelectorAll('#color-picker div').forEach(d => {
                d.style.borderColor = (d.style.backgroundColor === hexToRgb(c)) ? 'white' : 'transparent';
            });
        }

        function hexToRgb(hex) {
            const r = parseInt(hex.slice(1, 3), 16), g = parseInt(hex.slice(3, 5), 16), b = parseInt(hex.slice(5, 7), 16);
            return `rgb(${r}, ${g}, ${b})`;
        }

        function saveEv() {
            const title = document.getElementById('ev-title').value || "Sem título";
            const date = document.getElementById('ev-date').value;
            const time = document.getElementById('ev-time').value || "10:00";
            const id = document.getElementById('ev-id-val')?.value || Date.now().toString();

            if(!date) return alert("Escolha uma data!");

            saveHist();
            const existing = evs.findIndex(x => x.id === id);
            const data = { id, title, date, time, color: selColor };

            if(existing > -1) evs[existing] = data;
            else evs.push(data);

            sync();
            closeModal();
            render();
            showToast(existing > -1 ? "Atualizado" : "Criado");
        }

        function editEv(id) {
            const e = evs.find(x => x.id === id);
            openModal();
            document.getElementById('modal-title').innerText = "Editar Evento";
            document.getElementById('ev-title').value = e.title;
            document.getElementById('ev-date').value = e.date;
            document.getElementById('ev-time').value = e.time;
            selCol(e.color);
            
            const h = document.createElement('input');
            h.type = 'hidden'; h.id = 'ev-id-val'; h.value = e.id;
            document.getElementById('event-modal').appendChild(h);
            document.getElementById('ev-del').classList.remove('hidden');
        }

        function deleteEv() {
            const id = document.getElementById('ev-id-val').value;
            saveHist();
            evs = evs.filter(x => x.id !== id);
            sync();
            closeModal();
            render();
            showToast("Removido");
        }

        document.getElementById('quick-input').onkeypress = (e) => {
            if(e.key === 'Enter' && e.target.value) {
                saveHist();
                evs.push({
                    id: Date.now().toString(),
                    title: e.target.value,
                    date: curr.toISOString().split('T')[0],
                    time: "12:00",
                    color: "#FF6A00"
                });
                sync();
                e.target.value = '';
                render();
                showToast("Adicionado");
            }
        };

        function createRipple(e) {
            const cell = e.currentTarget;
            const circle = document.createElement("span");
            const diameter = Math.max(cell.clientWidth, cell.clientHeight);
            const radius = diameter / 2;
            
            const rect = cell.getBoundingClientRect();
            circle.style.width = circle.style.height = `${diameter}px`;
            circle.style.left = `${e.clientX - rect.left - radius}px`;
            circle.style.top = `${e.clientY - rect.top - radius}px`;
            circle.classList.add("ripple");
            
            const ripple = cell.getElementsByClassName("ripple")[0];
            if (ripple) ripple.remove();
            cell.appendChild(circle);
        }

        function saveHist() { hist.push(JSON.stringify(evs)); }
        function undo() {
            if(hist.length) {
                evs = JSON.parse(hist.pop());
                sync();
                render();
                document.getElementById('toast').classList.remove('show');
            }
        }

        function showToast(m) {
            const t = document.getElementById('toast');
            document.getElementById('t-msg').innerText = m;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3500);
        }

        function sync() { localStorage.setItem('evs_v3', JSON.stringify(evs)); }

        render();
    </script>
</body>
</html>

